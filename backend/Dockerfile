# 1. Базовый образ: выбираем легковесный Alpine с Node.js версии 18
FROM node:18-alpine

# 2. Рабочая директория внутри контейнера
WORKDIR /app

# 3. Копируем package.json и package-lock.json (если есть) в рабочую директорию
#    Благодаря этому, если мы меняем только код, зависимости переустанавливаться не будут,
#    а воспользуются закешированным слоем.
COPY package*.json ./

# 4. Устанавливаем зависимости. Ключ --production гарантирует, что установятся только
#    "dependencies", а не "devDependencies". Если нам нужен nodemon внутри контейнера — ставьте без --production.
RUN npm install --production

# 5. Копируем остальные файлы (весь код приложения) в контейнер
COPY . .

# 6. Открываем порт 5000 (этот порт должен совпадать с тем, на котором слушает Express)
EXPOSE 5000

# 7. Описываем команду, которая запускается при старте контейнера
#    Здесь мы используем обычный node, а не nodemon, чтобы не устанавливать devDependencies в продакшен.
CMD ["node", "server.js"]
